document.getElementById("schedule-post").addEventListener("click", function() {
    let imageInput = document.getElementById("image-upload");
    if (imageInput.files.length === 0) {
        alert("‚ùå Please select an image.");
        return;
    }

    let caption = document.getElementById("caption-status").textContent.includes("‚úÖ Caption Added:")
        ? document.getElementById("caption-status").textContent.replace("‚úÖ Caption Added: ", "").trim()
        : "";
    let scheduleDate = document.getElementById("schedule-date").value.trim();
    let scheduleTime = document.getElementById("schedule-time").value.trim();
    let scheduleDateTime = `${scheduleDate} ${scheduleTime}`;

    if (caption === "" || scheduleDate === "" || scheduleTime === "") {
        alert("‚ùå Please enter a caption and select a date & time.");
        return;
    }

    let imageFile = imageInput.files[0];
    let formData = new FormData();
    formData.append("file", imageFile);

    // Step 1: Upload Image to imgbb (Free Image Hosting)
    fetch("https://api.imgbb.com/1/upload?key=YOUR_IMGBB_API_KEY", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) throw new Error("Image upload failed");

        let imageUrl = data.data.url; // Get uploaded image URL

        let postData = {
            image: imageUrl, // Send Image URL instead of Base64
            caption: caption,
            scheduled_time: scheduleDateTime
        };

        // Step 2: Send Post Data to Make.com Webhook
        return fetch("https://hook.eu2.make.com/tm8tj1xohh2eh6bs5b0gw9irhlpuqmj2", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(postData)
        });
    })
    .then(response => {
        if (!response.ok) {
            throw new Error("Failed to send post to Make.com");
        }
        return response.json();
    })
    .then(() => {
        alert("üéâ Post Sent to Make.com Successfully!");
    })
    .catch(error => {
        console.error("‚ùå Error:", error);
        alert("Failed to send post to Make.com. Check console for details.");
    });
});
